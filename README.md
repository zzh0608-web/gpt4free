written by xtekky,forked by zzh
